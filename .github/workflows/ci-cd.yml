name: CI/CD - .NET + Docker Compose + Artefacto

on:
  push:
    branches: [master]

jobs:
  build-test:
    name: ğŸ§ª Build + Test + Docker Save
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ” Checkout del cÃ³digo
        uses: actions/checkout@v3

      - name: âš™ï¸ Configurar .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '8.0.x'

      - name: ğŸ“¦ Restaurar dependencias
        run: dotnet restore

      - name: ğŸ› ï¸ Compilar soluciÃ³n
        run: dotnet build --configuration Release --no-restore

      - name: ğŸ§ª Ejecutar pruebas unitarias
        run: dotnet test --no-build --configuration Release

      - name: ğŸ³ Construir imÃ¡genes Docker Compose
        run: docker-compose build microserive-producto

      - name: ğŸ“¦ Exportar imÃ¡genes como artefacto
        run: |
          docker save $(docker images --format "{{.Repository}}:{{.Tag}}" | grep -v "<none>") -o images.tar

      - name: ğŸ“¤ Subir artefacto Docker
        uses: actions/upload-artifact@v3
        with:
          name: docker-images
          path: images.tar

  aprobar:
    name: âœ… AprobaciÃ³n manual
    needs: build-test
    runs-on: ubuntu-latest
    environment:
      name: produccion
    steps:
      - run: echo "Esperando aprobaciÃ³n..."

  